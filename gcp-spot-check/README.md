# GCP Spot Instance ä¿æ´»æœåŠ¡

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue)
![License](https://img.shields.io/badge/license-MIT-green)
![Platform](https://img.shields.io/badge/platform-Linux-lightgrey)
![Shell](https://img.shields.io/badge/shell-bash-orange)

**è‡ªåŠ¨ç›‘æ§å’Œç»´æŠ¤ Google Cloud Platform Spot å®ä¾‹è¿è¡ŒçŠ¶æ€çš„æ™ºèƒ½å·¥å…·**

[åŠŸèƒ½ç‰¹æ€§](## âœ¨ åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—) â€¢ [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚) â€¢ [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

</div>

---

## ğŸ“‹ ç®€ä»‹

GCP Spot Instance ä¿æ´»æœåŠ¡æ˜¯ä¸€ä¸ªä¸“ä¸º Google Cloud Platform Spot å®ä¾‹è®¾è®¡çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ã€‚å®ƒèƒ½å¤Ÿè‡ªåŠ¨ç›‘æ§ Spot å®ä¾‹çš„è¿è¡ŒçŠ¶æ€ï¼Œå¹¶åœ¨å®ä¾‹è¢«æŠ¢å æˆ–åœæ­¢æ—¶è‡ªåŠ¨é‡å¯ï¼Œç¡®ä¿æ‚¨çš„æœåŠ¡æŒç»­å¯ç”¨ã€‚

### ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªå·¥å…·ï¼Ÿ

- **Spot å®ä¾‹ä»·æ ¼ä¼˜æƒ **ï¼šç›¸æ¯”æŒ‰éœ€å®ä¾‹å¯èŠ‚çœé«˜è¾¾ 91% çš„æˆæœ¬
- **è‡ªåŠ¨æ¢å¤æœåŠ¡**ï¼šå®ä¾‹è¢«æŠ¢å åè‡ªåŠ¨é‡å¯ï¼Œæ— éœ€äººå·¥å¹²é¢„
- **å¤šè´¦å·ç®¡ç†**ï¼šæ”¯æŒåŒæ—¶ç®¡ç†å¤šä¸ª GCP è´¦å·ä¸‹çš„æ‰€æœ‰å®ä¾‹
- **æ™ºèƒ½å‘ç°**ï¼šè‡ªåŠ¨æ‰«æå¹¶å¯¼å…¥è´¦å·ä¸‹çš„æ‰€æœ‰å®ä¾‹

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ”„ **è‡ªåŠ¨ç›‘æ§**ï¼šå®šæ—¶æ£€æŸ¥å®ä¾‹çŠ¶æ€ï¼Œæ”¯æŒè‡ªå®šä¹‰æ£€æŸ¥é—´éš”
- ğŸš€ **è‡ªåŠ¨é‡å¯**ï¼šæ£€æµ‹åˆ°å®ä¾‹åœæ­¢æ—¶ç«‹å³å‘é€å¯åŠ¨å‘½ä»¤
- ğŸŒ **å¤šè´¦å·æ”¯æŒ**ï¼šåŒæ—¶ç®¡ç†å¤šä¸ª GCP è´¦å·å’Œé¡¹ç›®
- ğŸ” **è‡ªåŠ¨å‘ç°**ï¼šä¸€é”®æ‰«æå¹¶å¯¼å…¥è´¦å·ä¸‹çš„æ‰€æœ‰å®ä¾‹
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**ï¼šå®æ—¶æŸ¥çœ‹ç›‘æ§ç»Ÿè®¡å’Œè¿è¡ŒçŠ¶æ€
- ğŸ“ **å®Œæ•´æ—¥å¿—**ï¼šè¯¦ç»†è®°å½•æ‰€æœ‰æ“ä½œå’ŒçŠ¶æ€å˜åŒ–

### æŠ€æœ¯ç‰¹ç‚¹
- **é›¶ä¾èµ–å®‰è£…**ï¼šè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£…æ‰€éœ€ç»„ä»¶
- **æ™ºèƒ½è·¯å¾„é€‚é…**ï¼šè‡ªåŠ¨é€‰æ‹©å¯ç”¨çš„æ—¥å¿—å­˜å‚¨è·¯å¾„
- **å®‰å…¨é…ç½®ç®¡ç†**ï¼šåŠ å¯†å­˜å‚¨æœåŠ¡è´¦å·å¯†é’¥
- **çµæ´»çš„æ£€æŸ¥ç­–ç•¥**ï¼šæ”¯æŒåˆ†é’Ÿçº§å’Œå°æ—¶çº§æ£€æŸ¥é—´éš”
- **å³æ—¶ç”Ÿæ•ˆ**ï¼šæ·»åŠ ç›‘æ§åç«‹å³æ‰§è¡Œé¦–æ¬¡æ£€æŸ¥

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å®‰è£…

```bash
sudo bash -c "$(curl -fsSL https://raw.githubusercontent.com/crazy0x70/scripts/refs/heads/main/gcp-spot-check/gcp-spot-check.sh)" @ install
```

### ä½¿ç”¨å‘½ä»¤

å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ç®¡ç†ç•Œé¢ï¼š

```bash
sudo gcpsc
```

### ä¸€é”®å¸è½½

```bash
sudo bash -c "$(curl -fsSL https://raw.githubusercontent.com/crazy0x70/scripts/refs/heads/main/gcp-spot-check/gcp-spot-check.sh)" @ remove
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### 1. æ·»åŠ  GCP è´¦å·

å¯åŠ¨ `gcpsc` åï¼Œé€‰æ‹© "è´¦å·ç®¡ç†" â†’ "æ·»åŠ æ–°è´¦å·"ï¼Œæ”¯æŒä¸‰ç§è®¤è¯æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šæœåŠ¡è´¦å·ï¼ˆæ¨èï¼‰
```
1. å‡†å¤‡æœåŠ¡è´¦å· JSON å¯†é’¥æ–‡ä»¶
2. é€‰æ‹© "ä½¿ç”¨æœåŠ¡è´¦å· JSON å¯†é’¥æ–‡ä»¶"
3. è¾“å…¥å¯†é’¥æ–‡ä»¶è·¯å¾„
4. é€‰æ‹©æ˜¯å¦è‡ªåŠ¨å‘ç°å®ä¾‹
```

#### æ–¹å¼äºŒï¼šç²˜è´´å¯†é’¥å†…å®¹
```
1. é€‰æ‹© "ç²˜è´´ JSON å¯†é’¥å†…å®¹"
2. ç²˜è´´å®Œæ•´çš„ JSON å†…å®¹
3. æŒ‰ Ctrl+D ç»“æŸè¾“å…¥
```

#### æ–¹å¼ä¸‰ï¼šä¸ªäººè´¦å·
```
1. é€‰æ‹© "ä½¿ç”¨ä¸ªäºº Google è´¦å·ç™»å½•"
2. å¤åˆ¶æ˜¾ç¤ºçš„ URL åˆ°æµè§ˆå™¨
3. ç™»å½•å¹¶æˆæƒ
4. å°†æˆæƒç ç²˜è´´å›ç»ˆç«¯
```

### 2. è‡ªåŠ¨å‘ç°å®ä¾‹

æ·»åŠ è´¦å·åï¼Œç³»ç»Ÿä¼šè¯¢é—®æ˜¯å¦è‡ªåŠ¨å‘ç°è¯¥è´¦å·ä¸‹çš„æ‰€æœ‰å®ä¾‹ï¼š

```bash
æ˜¯å¦è‡ªåŠ¨å‘ç°å¹¶å¯¼å…¥è¯¥è´¦å·ä¸‹çš„æ‰€æœ‰å®ä¾‹ï¼Ÿ[y/N]: y
è¯·è¾“å…¥é»˜è®¤æ£€æŸ¥é—´éš”ï¼ˆåˆ†é’Ÿï¼Œé»˜è®¤10ï¼‰: 10
```

ç³»ç»Ÿå°†è‡ªåŠ¨ï¼š
- æ‰«ææ‰€æœ‰å¯è®¿é—®çš„é¡¹ç›®
- å‘ç°æ‰€æœ‰è®¡ç®—å®ä¾‹
- å¯¼å…¥å®ä¾‹å¹¶è®¾ç½®ç›‘æ§
- ç«‹å³æ‰§è¡Œé¦–æ¬¡çŠ¶æ€æ£€æŸ¥

### 3. ç®¡ç†ç›‘æ§å®ä¾‹

åœ¨è´¦å·ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥ï¼š

- **æŸ¥çœ‹å®ä¾‹åˆ—è¡¨**ï¼šæ˜¾ç¤ºæ‰€æœ‰ç›‘æ§çš„å®ä¾‹åŠå…¶æ£€æŸ¥é—´éš”
- **ä¿®æ”¹æ£€æŸ¥é—´éš”**ï¼šå•ç‹¬æˆ–æ‰¹é‡ä¿®æ”¹å®ä¾‹çš„æ£€æŸ¥é¢‘ç‡
- **ç«‹å³æ£€æŸ¥**ï¼šæ‰‹åŠ¨è§¦å‘æŒ‡å®šå®ä¾‹çš„çŠ¶æ€æ£€æŸ¥
- **åˆ é™¤ç›‘æ§**ï¼šç§»é™¤ä¸éœ€è¦ç›‘æ§çš„å®ä¾‹
- **æŸ¥çœ‹è¯¦æƒ…**ï¼šæ˜¾ç¤ºå®ä¾‹çš„å®Œæ•´ä¿¡æ¯å’Œæœ€åæ£€æŸ¥æ—¶é—´

### 4. æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

ä¸»èœå•æä¾›å¤šç§çŠ¶æ€æŸ¥çœ‹é€‰é¡¹ï¼š

- **ç›‘æ§ç»Ÿè®¡**ï¼šæŸ¥çœ‹è´¦å·ã€é¡¹ç›®ã€å®ä¾‹çš„æ€»ä½“ç»Ÿè®¡
- **è¿è¡Œæ—¥å¿—**ï¼šæŸ¥çœ‹æœ€è¿‘çš„æ“ä½œæ—¥å¿—å’ŒçŠ¶æ€å˜åŒ–
- **æ‰‹åŠ¨æ£€æŸ¥**ï¼šç«‹å³æ‰§è¡Œä¸€æ¬¡å…¨é‡çŠ¶æ€æ£€æŸ¥

## ğŸ”§ é…ç½®è¯´æ˜

### æ£€æŸ¥é—´éš”è®¾ç½®

- **1-60 åˆ†é’Ÿ**ï¼šæŒ‰åˆ†é’Ÿçº§åˆ«æ£€æŸ¥
- **å¤§äº 60 åˆ†é’Ÿ**ï¼šè‡ªåŠ¨è½¬æ¢ä¸ºå°æ—¶çº§åˆ«ï¼ˆå¦‚ 120 åˆ†é’Ÿ = æ¯ 2 å°æ—¶ï¼‰
- **é»˜è®¤å€¼**ï¼š10 åˆ†é’Ÿ

### æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ç±»å‹ | è·¯å¾„ |
|---------|------|
| ä¸»ç¨‹åº | `/usr/local/bin/gcpsc` |
| é…ç½®æ–‡ä»¶ | `/etc/gcpsc/config.json` |
| æœåŠ¡è´¦å·å¯†é’¥ | `/etc/gcpsc/keys/` |
| æ£€æŸ¥æ—¶é—´è®°å½• | `/etc/gcpsc/lastcheck/` |
| è¿è¡Œæ—¥å¿— | `/var/log/gcpsc.log` æˆ– `/tmp/gcpsc.log` |

### å®šæ—¶ä»»åŠ¡

å®‰è£…åä¼šè‡ªåŠ¨æ·»åŠ  crontab å®šæ—¶ä»»åŠ¡ï¼š
```bash
* * * * * /usr/local/bin/gcpsc check >/dev/null 2>&1
```

è¯¥ä»»åŠ¡æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä½†åªä¼šæ£€æŸ¥åˆ°è¾¾æ£€æŸ¥é—´éš”çš„å®ä¾‹ã€‚

## ğŸ’» ç³»ç»Ÿè¦æ±‚

### æ”¯æŒçš„æ“ä½œç³»ç»Ÿ

- **Debian/Ubuntu** (æ¨è)
- **CentOS/RHEL** 7+
- **Rocky Linux/AlmaLinux**
- **Fedora**

### å¿…éœ€æƒé™

#### GCP æƒé™
æœåŠ¡è´¦å·éœ€è¦ä»¥ä¸‹æƒé™ï¼š
- `compute.instances.get`
- `compute.instances.list`
- `compute.instances.start`
- `compute.zones.list`
- `resourcemanager.projects.get`

æ¨èè§’è‰²ï¼š
- **Compute Instance Admin** (roles/compute.instanceAdmin)
- æˆ– **Compute Admin** (roles/compute.admin)

#### ç³»ç»Ÿæƒé™
- éœ€è¦ root æˆ– sudo æƒé™è¿è¡Œ

### ä¾èµ–ç»„ä»¶

ä»¥ä¸‹ç»„ä»¶ä¼šè‡ªåŠ¨å®‰è£…ï¼š
- `gcloud` - Google Cloud SDK
- `jq` - JSON å¤„ç†å·¥å…·
- `cron` - å®šæ—¶ä»»åŠ¡æœåŠ¡

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ä¸€ï¼šç®¡ç†å•ä¸ªé¡¹ç›®çš„ Spot å®ä¾‹

```bash
# 1. å®‰è£…æœåŠ¡
sudo bash -c "$(curl -fsSL <script_url>)" @ install

# 2. æ·»åŠ æœåŠ¡è´¦å·
sudo gcpsc
é€‰æ‹©: 1 (è´¦å·ç®¡ç†)
é€‰æ‹©: a (æ·»åŠ æ–°è´¦å·)
é€‰æ‹©: 1 (ä½¿ç”¨æœåŠ¡è´¦å·)
è¾“å…¥: /path/to/service-account.json

# 3. è‡ªåŠ¨å‘ç°å®ä¾‹
æ˜¯å¦è‡ªåŠ¨å‘ç°: y
æ£€æŸ¥é—´éš”: 10

# å®Œæˆï¼å®ä¾‹å·²è‡ªåŠ¨åŠ å…¥ç›‘æ§
```

### åœºæ™¯äºŒï¼šæ‰¹é‡ç®¡ç†å¤šä¸ªè´¦å·

```bash
# å¯åŠ¨ç®¡ç†ç•Œé¢
sudo gcpsc

# ä½¿ç”¨å¿«é€Ÿå‘ç°åŠŸèƒ½
é€‰æ‹©: 2 (å¿«é€Ÿå‘ç°æ‰€æœ‰èµ„æº)
è¾“å…¥é»˜è®¤é—´éš”: 5

# ç³»ç»Ÿä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰å·²æ·»åŠ è´¦å·çš„æ–°å®ä¾‹
```

### åœºæ™¯ä¸‰ï¼šè°ƒæ•´ç›‘æ§ç­–ç•¥

```bash
# ä¿®æ”¹ç‰¹å®šå®ä¾‹çš„æ£€æŸ¥é—´éš”
sudo gcpsc
é€‰æ‹©: 1 (è´¦å·ç®¡ç†)
é€‰æ‹©è´¦å·
é€‰æ‹©: 2 (ä¿®æ”¹å®ä¾‹æ£€æŸ¥é—´éš”)
é€‰æ‹©å®ä¾‹ç¼–å·
è¾“å…¥æ–°é—´éš”: 30
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ— æ³•è¿æ¥åˆ° GCP

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. éªŒè¯æœåŠ¡è´¦å·æƒé™
3. ç¡®è®¤é¡¹ç›® ID æ­£ç¡®

### é—®é¢˜ï¼šå®ä¾‹æ— æ³•å¯åŠ¨

**å¯èƒ½åŸå› **ï¼š
- é…é¢é™åˆ¶
- èµ„æºä¸è¶³
- å®ä¾‹é…ç½®é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ GCP æ§åˆ¶å°çš„é…é¢ä½¿ç”¨æƒ…å†µ
2. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
3. æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨å‘½ä»¤

### é—®é¢˜ï¼šå®šæ—¶ä»»åŠ¡ä¸æ‰§è¡Œ

**æ£€æŸ¥æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹å®šæ—¶ä»»åŠ¡
crontab -l

# æŸ¥çœ‹ cron æœåŠ¡çŠ¶æ€
systemctl status cron  # Debian/Ubuntu
systemctl status crond # CentOS/RHEL

# æŸ¥çœ‹æ—¥å¿—
tail -f /var/log/gcpsc.log
```

## ğŸ“ æ—¥å¿—ç¤ºä¾‹

æ­£å¸¸è¿è¡Œæ—¥å¿—ï¼š
```
[2025-01-11 10:30:00] [INFO] [user@example.com/project-123/asia-east1-b/instance-1] çŠ¶æ€: RUNNING
[2025-01-11 10:31:00] [WARN] [user@example.com/project-456/us-central1-a/instance-2] ä¸åœ¨è¿è¡ŒçŠ¶æ€ï¼Œæ­£åœ¨å¯åŠ¨...
[2025-01-11 10:31:02] [INFO] [user@example.com/project-456/us-central1-a/instance-2] å¯åŠ¨å‘½ä»¤å·²å‘é€
[2025-01-11 10:31:35] [INFO] [user@example.com/project-456/us-central1-a/instance-2] å®ä¾‹å·²æˆåŠŸå¯åŠ¨
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### æŠ¥å‘Šé—®é¢˜

è¯·åœ¨ Issue ä¸­åŒ…å«ï¼š
1. æ“ä½œç³»ç»Ÿç‰ˆæœ¬
2. é”™è¯¯æ—¥å¿—
3. å¤ç°æ­¥éª¤

### åŠŸèƒ½å»ºè®®

æˆ‘ä»¬æ¬¢è¿æ–°åŠŸèƒ½å»ºè®®ï¼Œç‰¹åˆ«æ˜¯ï¼š
- ç›‘æ§æŒ‡æ ‡æ‰©å±•
- é€šçŸ¥é›†æˆ
- æ€§èƒ½ä¼˜åŒ–

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ‘¨â€ğŸ’» ä½œè€…

- **ä½œè€…**: crazy0x70
- **GitHub**: [https://github.com/crazy0x70/scripts](https://github.com/crazy0x70/scripts)
- **ç‰ˆæœ¬**: 1.0.0
- **å‘å¸ƒæ—¥æœŸ**: 2025-01-11

## ğŸŒŸ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Star â­ æ”¯æŒä¸€ä¸‹ï¼

---

<div align="center">

**[è¿”å›é¡¶éƒ¨](#gcp-spot-instance-ä¿æ´»æœåŠ¡)**

Made with â¤ï¸ by crazy0x70

</div>
